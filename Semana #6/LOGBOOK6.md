# Format String Lab

## Setup
In an initial phase we turned off the address randomization, to be sure that the attack can discover the location and order of the addresses of the program.

![SetupADR](Images/SetupADR.png)


Then we opened the terminals, one with the servers using the Docker from seed-labs 

![SetupDocker1](Images/SetupDocker1.png)
![SetupDocker2](Images/SetupDocker2.png)

and the other(the client) to comunicate with the servers. This allowed to see the mensages exchanged by both side. By sending one string to the server, using the command

![echohello](Images/echohello.png)

The server returns some useful addresses to the next tasks:

![hello](Images/hello.png)

Finally, we compiled the program that runs on the server (``format.c``) using the flag ``-z execstack`` because that's the only way to execute code inside the stack.
As a quick note, during the compilation we saw a warming message that was generated by a countermeasure implemented by the gcc compiler against format string vulnerabilities, but we ignored this for now.

![format.c-compilation](Images/format.c-compilation.png)

## Question 1 - Tasks 1-3

### Task 1 - Crashing the program

To crash the server, all that was needed was to insert the following input string:

![crash-sent](Images/crash-sent.png)

The format string retrieves the 5 address immediately above its position on the stack and attempts to print the string at that address. This most likely occurs in an area outside the process's virtual memory.

![crase-the-server](Images/crash-the-server.png)

Since the server did not receive the "Returned properly" message, the server crashed.

### Task 2 - Printing Out the Server Programâ€™s Memory

#### Task 2.A

To print the first 4 bytes of the input from the format string, the input needs to contain a known value to be more easily identified. In our case, we will use "AAAA", which in hexadecimal is "41414141".
The initial idea is to give as input "AAAA" concatenated with various "%x"
![2A-sent](Images/2Asent.png)

On the server output it was possible to see:
![2A-received](Images/2A-received.png)

The final "41414141" its the string address "AAAA" given as input. 
Between "AAAA" and "41414141" there are 504 chars and we know that one address is contituted by 8 char, so there are 504/8 = 63 addresses on the stack between the format string and the buffer.

We concluded then that in this program configuration, to print the first 4 bytes from the initial input we need to create a string with exactly "%x".
